---
interface Props {
  activeMenu?: string;
}

const { activeMenu } = Astro.props;

import { buildSearchIndex } from '../data/buildSearchIndex';

const searchIndex = await buildSearchIndex();
---

<div id="header-info" class="wrapper">
  <div class="container fullwidth">
    <ul>
      <li><span class="header-icon-pin"></span>88000 Ужгород, Україна</li>
      <li>
        <span class="header-icon-mail"></span>
        <a href="mailto:aikidoaikikai.academy@gmail.com" class="link-style2">
          aikidoaikikai.academy@gmail.com
        </a>
      </li>
      <li>
        <span class="header-icon-phone"></span>
        <a href="tel:+380509314601" class="link-style2">
          +38 (050) 931 46 01
        </a>
      </li>
    </ul>
  </div>
</div>

<div id="header" class="wrapper">
  <div id="logo" class="container fullwidth" style="padding: 20px 0;">
    <a href="/"></a>
  </div>

  <div id="primary-navigation" class="container fullwidth">
    <a class="menu-responsive">
      <span class="menu-icon-nav"></span>
      <span class="menu-title">Navigation</span>
    </a>

    <ul class="menu clearfix">
      <li class:list={[{ selectedLava: activeMenu === 'home' }]}>
        <a class:list={[{ current: activeMenu === 'home' }]} href="/">
          <span class="menu-icon-home"></span>Головна
        </a>
      </li>

      <li class:list={[{ selectedLava: activeMenu === 'about' }]}>
        <a class:list={[{ current: activeMenu === 'about' }]} href="/about">
          <span class="menu-icon-about"></span>Про нас
        </a>
      </li>

      <li>
        <a href="/video">
          <span class="menu-icon-features"></span>Відео
        </a>
      </li>

      <li>
        <a href="/blog">
          <span class="menu-icon-blog"></span>Новини
        </a>
      </li>

      <li>
        <a href="/rozklad-seminariv">
          Розклад семінарів
        </a>
      </li>

      <li class:list={[{ selectedLava: activeMenu === 'contacts' }]}>
        <a class:list={[{ current: activeMenu === 'contacts' }]} href="/contacts">
          <span class="menu-icon-contact"></span>Контакти
        </a>
      </li>

      <li class="menu-search">
        <a id="open-search" style="cursor:pointer;">
        <span class="search-icon"></span> Пошук
        </a>
      </li>
    </ul>

    <!-- Пошук -->
    <div id="search-box" class="search-box">
      <input
        type="text"
        id="search-input"
        placeholder="Пошук по сайту..."
        autocomplete="off"
      />
      <div id="search-results"></div>
    </div>
  </div>
</div>

<!-- Передаємо індекс у браузер -->
 <>
<script is:inline define:vars={{ searchIndex }}>
  const SEARCH_INDEX = searchIndex;
</script>

<!-- Логіка пошуку -->
<script>
  document.addEventListener('DOMContentLoaded', () => {

    const searchIndex = JSON.parse(`{JSON.stringify(searchIndex)}`);

    const btn = document.getElementById('open-search') as HTMLElement | null;
    const box = document.getElementById('search-box') as HTMLElement | null;
    const input = document.getElementById('search-input') as HTMLInputElement | null;
    const results = document.getElementById('search-results') as HTMLElement | null;

    if (!btn || !box || !input || !results) return;

    btn.addEventListener('click', () => {
      box.style.display = box.style.display === 'block' ? 'none' : 'block';
      input.focus();
    });

    input.addEventListener('input', () => {
      const q = input.value.toLowerCase();
      results.innerHTML = '';

      if (q.length < 2) return;

      const filtered = searchIndex.filter(item =>
        item.title.toLowerCase().includes(q) ||
        item.content.includes(q)
      );

      filtered.slice(0, 10).forEach(item => {
        const a = document.createElement('a');
        a.href = item.url;
        a.textContent = item.title;
        results.appendChild(a);
      });
    });

    document.addEventListener('click', (e) => {
      const target = e.target as Node;
      if (!box.contains(target) && !btn.contains(target)) {
        box.style.display = 'none';
      }
    });

  });
</script>


